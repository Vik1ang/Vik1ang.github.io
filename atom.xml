<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://Vik1ang.github.io</id>
    <title>Gridea</title>
    <updated>2022-11-19T03:08:38.926Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://Vik1ang.github.io"/>
    <link rel="self" href="https://Vik1ang.github.io/atom.xml"/>
    <subtitle>Vik1ang&apos;s blog</subtitle>
    <logo>https://Vik1ang.github.io/images/avatar.png</logo>
    <icon>https://Vik1ang.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯çš„å¦ä¸€ä¸ªæ–¹æ¡ˆ: Server Side Events(SSE)]]></title>
        <id>https://Vik1ang.github.io/post/fu-wu-duan-xiang-ke-hu-duan-tui-song-xin-xi-de-ling-yi-ge-fang-an-server-side-eventssse/</id>
        <link href="https://Vik1ang.github.io/post/fu-wu-duan-xiang-ke-hu-duan-tui-song-xin-xi-de-ling-yi-ge-fang-an-server-side-eventssse/">
        </link>
        <updated>2022-11-19T00:50:21.000Z</updated>
        <content type="html"><![CDATA[<p>å› ä¸ºå·¥ä½œä¸Šçš„åŸå› , è¿™ç¯‡æ–‡ç« ä¼šç”¨<code>C#</code> æ¥å®ç°</p>
<h1 id="åœºæ™¯">åœºæ™¯</h1>
<p>åœ¨å¼€å‘Webé¡¹ç›®çš„æ—¶å€™, å¦‚æœ<strong>æœåŠ¡å™¨éœ€è¦ä¸»åŠ¨å¹¶ä¸æ–­åœ°æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯</strong>, å¸¸ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆ:</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚, é˜»å¡ç­‰å¾…é€šçŸ¥å¹¶è¿”å›ç»“æœ, é€šçŸ¥å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚, æˆ–è€…å®¢æˆ·ç«¯ä¸æ–­çš„å‘æœåŠ¡ç«¯è¿›è¡Œè¯·æ±‚, è¿™æ ·å¯èƒ½åœ¨å¾ˆé•¿æ—¶é—´å†…ä¸æ–­å»ºç«‹ç½‘ç»œè¿æ¥ç„¶åå†æ–­å¼€, éå¸¸çš„æ¶ˆè€—èµ„æº</li>
<li><code>WebSocket</code>æ˜¯ä¸é”™çš„è§£å†³æ–¹æ¡ˆ, åªéœ€è¦ä¸€æ¬¡ç½‘ç»œè¿æ¥å°±èƒ½è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¸»åŠ¨å‘æ¶ˆæ¯æ”¶æ¶ˆæ¯, ä½†æ˜¯å†æˆ‘çš„ä½¿ç”¨åœºæ™¯é‡Œ, å®¢æˆ·ç«¯åªéœ€è¦æ¥æ”¶æœåŠ¡å™¨çš„æ¨é€, æ•…æˆ‘æ²¡æœ‰é€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆ</li>
<li><code>Server Side Event</code> å°±æ˜¯è¿™ç¯‡æ–‡ç« è¦è®²çš„ä¸»è¦å†…å®¹, å¯ä»¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€æ¬¡è¿æ¥å, ç”±æœåŠ¡ç«¯ä¸æ–­çš„å‘å®¢æˆ·ç«¯æ¨é€, å¹¶ä¸”æ˜¯å»ºç«‹åœ¨HTTPåè®®ä¸Š, ç»å¤§éƒ¨åˆ†æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</li>
<li><code>SignalR</code> è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæ˜¯å¯ä»¥çš„åº”è¯¥ä¹Ÿå¾ˆæˆç†Ÿ, ä½†æ˜¯æˆ‘æ²¡æ€ä¹ˆäº†è§£è¿‡</li>
</ol>
<h1 id="sse">SSE</h1>
<h2 id="sse-çš„æœ¬è´¨">SSE çš„æœ¬è´¨</h2>
<p>ä»<code>HTTP</code>è¿™ä¸ªåè®®æœ¬èº«æ¥è®²æ˜¯æ— æ³•åšåˆ°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ä¿¡æ¯, ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <strong>æµ(<code>streaming</code>)</strong> æ¥å˜é€š</p>
<p>é€šè¿‡æµ, å‘é€çš„å°±ä¸æ˜¯ä¸€æ¬¡æ•°æ®åŒ…, è€Œæ˜¯ä¸€ä¸ªæ•°æ®æµ, ä¼šè¿ç»­ä¸æ–­çš„å‘é€, è€Œä¸”å®¢æˆ·ç«¯ä¹Ÿä¸ä¼šå…³é—­è¿æ¥ <strong>(å…¶å®å®¢æˆ·ç«¯æ˜¯å¯ä»¥ä¸»åŠ¨è¿›è¡Œå…³é—­çš„)</strong> , æ¯”å¦‚åœ¨çº¿è§†é¢‘çš„åŸç†å°±æ˜¯å¦‚æ­¤, æ¢å¥è¯è¯´å°±æ˜¯é€šè¿‡æµçš„æ–¹å¼å®ç°äº†ä¸€æ¬¡ç”¨æ—¶å¾ˆé•¿çš„ä¸‹è½½æˆ–è€…è¯·æ±‚.</p>
<p><code>SSE</code> å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸ªæµçš„æœºåˆ¶, å‘æµè§ˆå™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯</p>
<h2 id="sse-åŒ…">SSE åŒ…</h2>
<p><code>SSE</code> çš„æ•°æ®åŒ…å¿…é¡»æ˜¯<code>UTF-8</code>ç¼–ç çš„æ–‡æœ¬, <code>Header</code> å¤§æ¦‚é•¿è¿™æ ·</p>
<pre><code>Content-Type: text/event-stream
Cache-Control: no-cache, no-transform
Connection: keep-alive
</code></pre>
<p><strong><code>Content-Type</code> å¿…é¡»æŒ‡å®š <code>Mime</code> ç±»å‹ä¸º <code>event-stream</code></strong></p>
<p>æ¯ä¸€æ¬¡å‘é€çš„æ¶ˆæ¯, å¯ä»¥ç”±å¥½å‡ ä¸ª<code>message</code> ç»„æˆ, æ¯ä¸ª<code>message</code> ä¹‹é—´ç”¨  <code>\n\n</code> åˆ†éš”</p>
<p>æ¯ä¸ª <code>message</code> å†…éƒ¨å¯ä»¥æœ‰å¥½å‡ è¡Œ, æ¯ä¸€è¡Œéƒ½æ˜¯è¿™ç§æ ¼å¼</p>
<pre><code>[Field]: value\n
</code></pre>
<p>è¿™ä¸ª <code>Field</code> å¯ä»¥å–è¿™4ä¸ªå€¼:</p>
<ul>
<li><code>data</code></li>
<li><code>event</code></li>
<li><code>id</code></li>
<li><code>retry</code></li>
</ul>
<p>æˆ–è€…å¯ä»¥ä½¿ç”¨ <code>:</code> å¼€å¤´, ä»£è¡¨æ³¨é‡Š, é€šå¸¸æœåŠ¡å™¨éœ€è¦å‘¨æœŸæ€§çš„å‘æµè§ˆå™¨å‘é€ä¸€ä¸ªæ³¨é‡Š, ä¿æŒè¿æ¥ä¸æ–­</p>
<pre><code>: a comment
</code></pre>
<h3 id="data-å­—æ®µ"><code>data</code> å­—æ®µ</h3>
<blockquote>
<p>å¦‚æœæ•°æ®å¾ˆé•¿å¯ä»¥åˆ†æˆå¤šè¡Œå‘, æœ€åä¸€è¡Œç”¨ <code>\n\n</code> æ¥ç»“å°¾, å…¶ä½™è¡Œä½¿ç”¨ <code>\n</code></p>
<pre><code>data: line1\n
data: line end\n\n
</code></pre>
</blockquote>
<h3 id="id-å­—æ®µ"><code>id</code> å­—æ®µ</h3>
<p>æ ‡è¯†æ•°æ®ç¼–å·, å¯ä»¥ä¸ä¼ çš„</p>
<pre><code>id: 1\n
data: abc\n\n
</code></pre>
<h3 id="event-å­—æ®µ"><code>event</code> å­—æ®µ</h3>
<p>é»˜è®¤æ˜¯ <code>message</code> äº‹ä»¶, æµè§ˆå™¨å¯ä»¥ä½¿ç”¨ <code>addEventListener</code> ç›‘å¬éœ€è¦çš„äº‹ä»¶</p>
<pre><code>event: A event\n
data: A event data\n\n

data: empty event \n\n

event: B event\n
data: B event data\n\n
</code></pre>
<h3 id="retry-å­—æ®µ"><code>retry</code> å­—æ®µ</h3>
<p>æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨ <code>retry</code> å­—æ®µ, æŒ‡å®šæµè§ˆå™¨é‡æ–°å‘èµ·è¿æ¥çš„æ—¶é—´é—´éš”</p>
<pre><code>retry: 10000\n
</code></pre>
<p>ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´æµè§ˆå™¨é‡æ–°å‘èµ·è¿æ¥:</p>
<ol>
<li>æ—¶é—´é—´éš”åˆ°æœŸ</li>
<li>ç”±äºç½‘ç»œåŸå› , å¯¼è‡´è¿æ¥æ–­å¼€</li>
</ol>
<h1 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h1>
<p>å› ä¸ºå·¥ä½œä¸Šç”¨çš„æ˜¯ä»–, æ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿä½¿ç”¨ <code>Asp.NetCore</code> å½“ä½œä¾‹å­äº†</p>
<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<p>å…ˆå†™ä¸€ä¸ª<code>HttpContext</code> åˆå§‹åŒ– <code>SSE</code> å“åº”çš„æ‰©å±•æ–¹æ³•</p>
<pre><code class="language-java">public static class ServerSideEventHttpContextExtensions {
        public static async Task ServerSideEventInitAsync(this HttpContext ctx) {
                ctx.Response.Headers.Add(&quot;Cache-Control&quot;, &quot;no-cache, no-transform&quot;);
                ctx.Response.Headers.Add(&quot;Content-Type&quot;, &quot;text/event-stream; charset=utf-8&quot;);
                await ctx.Response.Body.FlushAsync();   
        }
}
</code></pre>
<p>æŠŠ<code>SSE</code>æ¶ˆæ¯å°è£…æˆä¸€ä¸ªå¯¹è±¡</p>
<pre><code class="language-java">public class ServerSideEvent
{
    #region Fields

    public string EventName { get; set; }
    public object Data { get; set; }
    public string Id { get; set; }
    public int? Retry { get; set; }

    #endregion

    #region Ctor

    public ServerSideEvent(string eventName, object data)
    {
        EventName = eventName;
        Data = data;
    }

    #endregion
}
</code></pre>
<p>å†å†™ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„æ–¹æ³•</p>
<pre><code class="language-java">public static class ServerSideEventHttpContextExtensions {
        ...

        public static async Task ServerSideEventSendAsync(this HttpContext ctx, ServerSideEvent sse)
        {
                if (string.IsNullOrWhiteSpace(sse.Id))
                {
                    await ctx.Response.WriteAsync(&quot;id: &quot; + sse.Id + &quot;\n&quot;);
                }

                if (sse.Retry is not null)
                {
                    await ctx.Response.WriteAsync(&quot;retry: &quot; + sse.Retry + &quot;\n&quot;);
                }

                await ctx.Response.WriteAsync(&quot;event: &quot; + sse.EventName + &quot;\n&quot;);

                var lines = sse.Data switch
                {
                    null =&gt; new[] { string.Empty },
                    string s =&gt; s.Split('\n').ToArray(),
                    _ =&gt; new[] { JsonSerializer.Serialize(sse.Data) }
                };

                foreach (var line in lines)
                {
                    await ctx.Response.WriteAsync(&quot;data: &quot; + line + &quot;\n&quot;);
                }

                await ctx.Response.WriteAsync(&quot;\n&quot;);
                await ctx.Response.Body.FlushAsync();
        }
}
</code></pre>
<h3 id="å‘é€">å‘é€</h3>
<pre><code class="language-java">[HttpGet(&quot;/sse&quot;)]
public async Task SSE()
{
        await HttpContext.ServerSideEventInitAsync();
        Random random = new Random();

        for (int i = 0; i &lt; 100; i++)
        {
                string eventName = string.Empty;
                eventName = i % 2 == 0 ? &quot;event1&quot; : &quot;event2&quot;;
                var sse = new ServerSideEvent(eventName, new { Foo = $&quot;{random.Next()}&quot;, Bar = $&quot;{random.Next()}&quot; })
                {
                        Id = $&quot;{random.Next()}&quot;
                 };
                 await HttpContext.ServerSideEventSendAsync(sse);
        }
}              
</code></pre>
<h1 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h1>
<p>åˆ†åˆ«ç›‘å¬ <code>event1</code> å’Œ <code>event2</code> äº‹ä»¶</p>
<pre><code class="language-js">const eventSource = new EventSource(&quot;/sse&quot;, { withCredentials: true } );
eventSource.addEventListener(&quot;event1&quot;, (event) =&gt; {
    console.log(JSON.parse(event.data));
});
eventSource.addEventListener(&quot;event2&quot;, (event) =&gt; {
    console.log(JSON.parse(event.data));
});
</code></pre>
<h1 id="æ•ˆæœ">æ•ˆæœ</h1>
<figure data-type="image" tabindex="1"><img src="https://Vik1ang.github.io/post-images/1668824535512.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://Vik1ang.github.io/post/hello-gridea/</id>
        <link href="https://Vik1ang.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="https://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>